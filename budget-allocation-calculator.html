<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Allocation Calculator — Young Budgeteer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #efefef;
      color: #222;
      min-height: 100vh;
    }

    header {
      background: #0B7D67;
      color: white;
      padding: 36px 24px 28px;
      text-align: center;
    }

    header h1 { font-size: 1.8rem; font-weight: 700; }
    header p  { margin-top: 6px; opacity: 0.88; font-size: 1rem; }

    .calc-wrapper {
      max-width: 860px;
      margin: 0 auto;
      padding: 28px 16px 60px;
    }

    .card {
      background: white;
      border-radius: 10px;
      padding: 24px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.07);
      margin-bottom: 20px;
    }

    .card h2 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
      margin-bottom: 18px;
      padding-bottom: 10px;
      border-bottom: 2px solid;
    }

    .card.needs h2   { color: #0B7D67; border-color: #e8f5f2; }
    .card.wants h2   { color: #e07b39; border-color: #fdf0e8; }
    .card.savings h2 { color: #6b8cba; border-color: #e8eef5; }
    .card.income h2  { color: #0B7D67; border-color: #e8f5f2; }

    .card.needs   { border-top: 4px solid #0B7D67; }
    .card.wants   { border-top: 4px solid #e07b39; }
    .card.savings { border-top: 4px solid #6b8cba; }

    .bucket-target {
      display: inline-block;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 3px 10px;
      border-radius: 20px;
      margin-left: 8px;
      vertical-align: middle;
    }

    .card.needs   .bucket-target { background: #e8f5f2; color: #0B7D67; }
    .card.wants   .bucket-target { background: #fdf0e8; color: #e07b39; }
    .card.savings .bucket-target { background: #e8eef5; color: #6b8cba; }

    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .three-col {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 14px;
    }

    @media (max-width: 580px) {
      .two-col, .three-col { grid-template-columns: 1fr 1fr; }
    }

    .field { margin-bottom: 12px; }
    .field:last-child { margin-bottom: 0; }

    label {
      display: block;
      font-size: 0.73rem;
      font-weight: 600;
      color: #666;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .input-wrap { position: relative; }

    .input-wrap .pre {
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      color: #999;
      font-size: 0.88rem;
      pointer-events: none;
    }

    input[type="number"] {
      width: 100%;
      padding: 8px 12px 8px 24px;
      border: 1.5px solid #ddd;
      border-radius: 6px;
      font-size: 0.92rem;
      color: #222;
      transition: border-color 0.15s;
      -moz-appearance: textfield;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }

    input[type="number"]:focus { outline: none; border-color: #0B7D67; }

    .hint { font-size: 0.72rem; color: #bbb; margin-top: 3px; }

    /* Income summary bar */
    .income-summary {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid #eee;
    }

    .income-stat { flex: 1; min-width: 120px; text-align: center; }
    .income-stat .is-val { font-size: 1.2rem; font-weight: 700; color: #0B7D67; }
    .income-stat .is-lbl { font-size: 0.7rem; text-transform: uppercase; color: #aaa; letter-spacing: 0.05em; margin-top: 2px; }

    .calc-btn {
      display: block;
      width: 100%;
      padding: 14px;
      background: #0B7D67;
      color: white;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.15s;
      margin-bottom: 28px;
    }

    .calc-btn:hover { background: #096b57; }

    .hidden { display: none; }

    /* Scorecard */
    .scorecard {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 14px;
      margin-bottom: 20px;
    }

    @media (max-width: 600px) { .scorecard { grid-template-columns: 1fr 1fr; } }

    .score-card {
      background: white;
      border-radius: 10px;
      padding: 16px 14px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.07);
      text-align: center;
      border-top: 4px solid #ddd;
    }

    .score-card.status-good   { border-top-color: #0B7D67; }
    .score-card.status-warn   { border-top-color: #f0a500; }
    .score-card.status-over   { border-top-color: #c0392b; }
    .score-card.status-under  { border-top-color: #6b8cba; }
    .score-card.status-info   { border-top-color: #888; }

    .score-card .sc-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; color: #999; font-weight: 600; margin-bottom: 6px; }
    .score-card .sc-val   { font-size: 1.5rem; font-weight: 800; color: #222; line-height: 1; }
    .score-card .sc-target{ font-size: 0.72rem; color: #bbb; margin-top: 4px; }
    .score-card .sc-badge {
      display: inline-block;
      margin-top: 6px;
      font-size: 0.65rem;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .badge-good  { background: #e8f5f2; color: #0B7D67; }
    .badge-warn  { background: #fff8e6; color: #c08000; }
    .badge-over  { background: #fdf0ee; color: #c0392b; }
    .badge-under { background: #e8eef5; color: #5578a0; }
    .badge-info  { background: #f0f0f0; color: #666; }

    /* Charts */
    .charts-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 640px) { .charts-row { grid-template-columns: 1fr; } }

    .chart-card {
      background: white;
      border-radius: 10px;
      padding: 22px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.07);
    }

    .chart-card h3 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #0B7D67;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .chart-wrap-bar  { position: relative; height: 200px; }
    .chart-wrap-donut { position: relative; height: 220px; }

    /* Category breakdown table */
    .table-card {
      background: white;
      border-radius: 10px;
      padding: 24px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.07);
      overflow-x: auto;
      margin-bottom: 20px;
    }

    .table-card h3 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #0B7D67;
      font-weight: 700;
      margin-bottom: 16px;
    }

    table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }

    thead tr { background: #0B7D67; color: white; }
    thead th { padding: 9px 14px; text-align: right; font-weight: 600; white-space: nowrap; }
    thead th:first-child { text-align: left; }
    thead th:nth-child(2) { text-align: left; }

    tbody tr:nth-child(even) { background: #f7faf9; }
    tbody tr.section-row { background: #f0f0f0; font-weight: 700; }
    tbody tr.total-row { background: #e8f5f2; font-weight: 700; border-top: 2px solid #0B7D67; }

    tbody td { padding: 8px 14px; text-align: right; border-bottom: 1px solid #eee; white-space: nowrap; }
    tbody td:first-child { text-align: left; color: #888; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.04em; }
    tbody td:nth-child(2) { text-align: left; }

    .bar-cell { width: 100px; padding-right: 14px; }
    .mini-bar { height: 8px; border-radius: 4px; background: #e0e0e0; overflow: hidden; }
    .mini-fill { height: 100%; border-radius: 4px; transition: width 0.4s; }
    .fill-needs   { background: #0B7D67; }
    .fill-wants   { background: #e07b39; }
    .fill-savings { background: #6b8cba; }
    .fill-tax     { background: #aaa; }

    /* Frameworks table */
    .frameworks-card {
      background: white;
      border-radius: 10px;
      padding: 24px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.07);
      overflow-x: auto;
    }

    .frameworks-card h3 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #0B7D67;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .frameworks-card p { font-size: 0.8rem; color: #aaa; margin-bottom: 16px; }
  </style>
</head>
<body>

<header>
  <h1>Budget Allocation Calculator</h1>
  <p>See exactly where your money goes — and how it stacks up against proven frameworks.</p>
</header>

<div class="calc-wrapper">

  <!-- INCOME -->
  <div class="card income">
    <h2>Your Income</h2>
    <div class="two-col">
      <div class="field">
        <label for="grossIncome">Monthly Gross Income</label>
        <div class="input-wrap">
          <span class="pre">$</span>
          <input type="number" id="grossIncome" value="6000" min="0" oninput="updateIncomeSummary()">
        </div>
        <div class="hint">Before taxes and deductions</div>
      </div>
      <div class="field">
        <label for="netIncome">Monthly Take-Home Pay</label>
        <div class="input-wrap">
          <span class="pre">$</span>
          <input type="number" id="netIncome" value="4500" min="0" oninput="updateIncomeSummary()">
        </div>
        <div class="hint">After all taxes and deductions</div>
      </div>
    </div>
    <div class="income-summary">
      <div class="income-stat">
        <div class="is-val" id="taxBurdenVal">$1,500</div>
        <div class="is-lbl">Taxes &amp; Deductions</div>
      </div>
      <div class="income-stat">
        <div class="is-val" id="taxPctVal">25.0%</div>
        <div class="is-lbl">Effective Rate</div>
      </div>
      <div class="income-stat">
        <div class="is-val" id="needsTargetVal">$2,250</div>
        <div class="is-lbl">50% Needs Target</div>
      </div>
      <div class="income-stat">
        <div class="is-val" id="wantsTargetVal">$1,350</div>
        <div class="is-lbl">30% Wants Target</div>
      </div>
      <div class="income-stat">
        <div class="is-val" id="savingsTargetVal">$900</div>
        <div class="is-lbl">20% Savings Target</div>
      </div>
    </div>
  </div>

  <!-- NEEDS -->
  <div class="card needs">
    <h2>Needs <span class="bucket-target">Target: 50%</span></h2>
    <div class="three-col">
      <div class="field">
        <label for="housing">Housing</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="housing" value="1400" min="0">
        </div>
        <div class="hint">Rent / mortgage / HOA</div>
      </div>
      <div class="field">
        <label for="utilities">Utilities</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="utilities" value="150" min="0">
        </div>
        <div class="hint">Electric, water, gas, internet, phone</div>
      </div>
      <div class="field">
        <label for="groceries">Groceries</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="groceries" value="400" min="0">
        </div>
      </div>
      <div class="field">
        <label for="transport">Transportation</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="transport" value="300" min="0">
        </div>
        <div class="hint">Car payment, gas, insurance</div>
      </div>
      <div class="field">
        <label for="healthcare">Health &amp; Medical</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="healthcare" value="100" min="0">
        </div>
        <div class="hint">Insurance premiums, copays, prescriptions</div>
      </div>
      <div class="field">
        <label for="minDebt">Minimum Debt Payments</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="minDebt" value="0" min="0">
        </div>
        <div class="hint">Minimum required payments only</div>
      </div>
      <div class="field">
        <label for="childcare">Childcare / Education</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="childcare" value="0" min="0">
        </div>
      </div>
      <div class="field">
        <label for="otherNeeds">Other Needs</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="otherNeeds" value="0" min="0">
        </div>
      </div>
    </div>
  </div>

  <!-- WANTS -->
  <div class="card wants">
    <h2>Wants <span class="bucket-target">Target: 30%</span></h2>
    <div class="three-col">
      <div class="field">
        <label for="dining">Dining Out &amp; Coffee</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="dining" value="200" min="0">
        </div>
      </div>
      <div class="field">
        <label for="entertainment">Entertainment &amp; Hobbies</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="entertainment" value="100" min="0">
        </div>
        <div class="hint">Movies, events, sports, games</div>
      </div>
      <div class="field">
        <label for="shopping">Shopping &amp; Clothing</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="shopping" value="100" min="0">
        </div>
      </div>
      <div class="field">
        <label for="travel">Travel &amp; Vacations</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="travel" value="100" min="0">
        </div>
        <div class="hint">Monthly average (annual ÷ 12)</div>
      </div>
      <div class="field">
        <label for="subscriptions">Subscriptions</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="subscriptions" value="50" min="0">
        </div>
        <div class="hint">Streaming, gym, apps, etc.</div>
      </div>
      <div class="field">
        <label for="personal">Personal Care</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="personal" value="50" min="0">
        </div>
        <div class="hint">Haircuts, cosmetics, self-care</div>
      </div>
      <div class="field">
        <label for="gifts">Gifts &amp; Celebrations</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="gifts" value="50" min="0">
        </div>
        <div class="hint">Monthly average</div>
      </div>
      <div class="field">
        <label for="otherWants">Other Wants</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="otherWants" value="0" min="0">
        </div>
      </div>
    </div>
  </div>

  <!-- SAVINGS -->
  <div class="card savings">
    <h2>Savings &amp; Debt Payoff <span class="bucket-target">Target: 20%</span></h2>
    <div class="three-col">
      <div class="field">
        <label for="retirement">Retirement</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="retirement" value="300" min="0">
        </div>
        <div class="hint">401k, IRA contributions</div>
      </div>
      <div class="field">
        <label for="emergency">Emergency Fund</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="emergency" value="100" min="0">
        </div>
      </div>
      <div class="field">
        <label for="investments">Other Investments</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="investments" value="0" min="0">
        </div>
        <div class="hint">Brokerage, index funds, crypto</div>
      </div>
      <div class="field">
        <label for="extraDebt">Extra Debt Paydown</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="extraDebt" value="0" min="0">
        </div>
        <div class="hint">Above minimum payments</div>
      </div>
      <div class="field">
        <label for="savingsGoals">Savings Goals</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="savingsGoals" value="0" min="0">
        </div>
        <div class="hint">House down payment, car, etc.</div>
      </div>
      <div class="field">
        <label for="otherSavings">Other Savings</label>
        <div class="input-wrap"><span class="pre">$</span>
          <input type="number" id="otherSavings" value="0" min="0">
        </div>
      </div>
    </div>
  </div>

  <button class="calc-btn" onclick="calculate()">Analyze My Budget</button>

  <!-- RESULTS -->
  <div id="results" class="hidden">

    <!-- Scorecard -->
    <div class="scorecard" id="scorecard"></div>

    <!-- Charts -->
    <div class="charts-row">
      <div class="chart-card">
        <h3>Actual vs. Target (50/30/20)</h3>
        <div class="chart-wrap-bar">
          <canvas id="barChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <h3>Where Your Money Goes</h3>
        <div class="chart-wrap-donut">
          <canvas id="donutChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Category breakdown -->
    <div class="table-card">
      <h3>Full Category Breakdown</h3>
      <table>
        <thead>
          <tr>
            <th>Bucket</th>
            <th>Category</th>
            <th>Monthly</th>
            <th>% of Take-Home</th>
            <th style="min-width:110px">Visual</th>
          </tr>
        </thead>
        <tbody id="breakdownBody"></tbody>
      </table>
    </div>

    <!-- Frameworks comparison -->
    <div class="frameworks-card">
      <h3>Common Budget Frameworks</h3>
      <p>How your budget compares to different allocation methods — your numbers in parentheses.</p>
      <table>
        <thead>
          <tr>
            <th style="text-align:left">Framework</th>
            <th>Needs</th>
            <th>Wants</th>
            <th>Savings</th>
            <th style="text-align:left">Best For</th>
          </tr>
        </thead>
        <tbody id="frameworkBody"></tbody>
      </table>
    </div>

  </div>

</div>

<script>
  let barChart = null, donutChart = null;

  function $ (id) { return document.getElementById(id); }
  function val(id) { return parseFloat($(id).value) || 0; }
  function fmtD(n) { return '$' + Math.round(n).toLocaleString(); }
  function fmtP(n) { return n.toFixed(1) + '%'; }

  function updateIncomeSummary() {
    const gross = val('grossIncome');
    const net   = val('netIncome');
    const tax   = Math.max(0, gross - net);
    const taxPct = gross > 0 ? (tax / gross * 100) : 0;
    $('taxBurdenVal').textContent    = fmtD(tax);
    $('taxPctVal').textContent       = fmtP(taxPct);
    $('needsTargetVal').textContent  = fmtD(net * 0.50);
    $('wantsTargetVal').textContent  = fmtD(net * 0.30);
    $('savingsTargetVal').textContent= fmtD(net * 0.20);
  }

  function calculate() {
    const net   = val('netIncome');
    const gross = val('grossIncome');
    if (net <= 0) { alert('Please enter your monthly take-home pay.'); return; }

    // Needs
    const needsItems = [
      { label: 'Housing',            id: 'housing' },
      { label: 'Utilities',          id: 'utilities' },
      { label: 'Groceries',          id: 'groceries' },
      { label: 'Transportation',     id: 'transport' },
      { label: 'Health & Medical',   id: 'healthcare' },
      { label: 'Min. Debt Payments', id: 'minDebt' },
      { label: 'Childcare / Education', id: 'childcare' },
      { label: 'Other Needs',        id: 'otherNeeds' },
    ];

    const wantsItems = [
      { label: 'Dining Out & Coffee',     id: 'dining' },
      { label: 'Entertainment & Hobbies', id: 'entertainment' },
      { label: 'Shopping & Clothing',     id: 'shopping' },
      { label: 'Travel & Vacations',      id: 'travel' },
      { label: 'Subscriptions',           id: 'subscriptions' },
      { label: 'Personal Care',           id: 'personal' },
      { label: 'Gifts & Celebrations',    id: 'gifts' },
      { label: 'Other Wants',             id: 'otherWants' },
    ];

    const savingsItems = [
      { label: 'Retirement',         id: 'retirement' },
      { label: 'Emergency Fund',     id: 'emergency' },
      { label: 'Other Investments',  id: 'investments' },
      { label: 'Extra Debt Paydown', id: 'extraDebt' },
      { label: 'Savings Goals',      id: 'savingsGoals' },
      { label: 'Other Savings',      id: 'otherSavings' },
    ];

    const withVals = items => items.map(item => ({ ...item, amount: val(item.id) }));

    const needs   = withVals(needsItems);
    const wants   = withVals(wantsItems);
    const savings = withVals(savingsItems);

    const needsTotal   = needs.reduce((s, i) => s + i.amount, 0);
    const wantsTotal   = wants.reduce((s, i) => s + i.amount, 0);
    const savingsTotal = savings.reduce((s, i) => s + i.amount, 0);
    const totalSpent   = needsTotal + wantsTotal + savingsTotal;
    const taxAmount    = Math.max(0, gross - net);
    const remaining    = net - totalSpent;

    const needsPct   = net > 0 ? needsTotal   / net * 100 : 0;
    const wantsPct   = net > 0 ? wantsTotal   / net * 100 : 0;
    const savingsPct = net > 0 ? savingsTotal / net * 100 : 0;
    const remainPct  = net > 0 ? remaining    / net * 100 : 0;

    render({
      net, gross, taxAmount,
      needsItems: needs, wantsItems: wants, savingsItems: savings,
      needsTotal, wantsTotal, savingsTotal, totalSpent, remaining,
      needsPct, wantsPct, savingsPct, remainPct
    });
  }

  function scoreBucket(actual, target) {
    const diff = actual - target;
    const pctOff = Math.abs(diff) / target * 100;
    if (pctOff <= 5)      return { status: 'good',  badge: 'On Target',  cls: 'badge-good' };
    if (diff < 0)         return { status: 'under', badge: 'Under',      cls: 'badge-under' };
    if (pctOff <= 15)     return { status: 'warn',  badge: 'A Little Over', cls: 'badge-warn' };
    return                       { status: 'over',  badge: 'Over Budget', cls: 'badge-over' };
  }

  function render(d) {
    $('results').classList.remove('hidden');

    // Scorecard
    const needsScore   = scoreBucket(d.needsPct,   50);
    const wantsScore   = scoreBucket(d.wantsPct,   30);
    const savingsScore = scoreBucket(d.savingsPct, 20);
    const remainColor  = d.remaining >= 0 ? 'status-good' : 'status-over';

    $('scorecard').innerHTML = `
      <div class="score-card status-${needsScore.status}">
        <div class="sc-label">Needs</div>
        <div class="sc-val">${fmtP(d.needsPct)}</div>
        <div class="sc-target">Target: 50% &bull; ${fmtD(d.needsTotal)}/mo</div>
        <span class="sc-badge ${needsScore.cls}">${needsScore.badge}</span>
      </div>
      <div class="score-card status-${wantsScore.status}">
        <div class="sc-label">Wants</div>
        <div class="sc-val">${fmtP(d.wantsPct)}</div>
        <div class="sc-target">Target: 30% &bull; ${fmtD(d.wantsTotal)}/mo</div>
        <span class="sc-badge ${wantsScore.cls}">${wantsScore.badge}</span>
      </div>
      <div class="score-card status-${savingsScore.status}">
        <div class="sc-label">Savings</div>
        <div class="sc-val">${fmtP(d.savingsPct)}</div>
        <div class="sc-target">Target: 20% &bull; ${fmtD(d.savingsTotal)}/mo</div>
        <span class="sc-badge ${savingsScore.cls}">${savingsScore.badge}</span>
      </div>
      <div class="score-card ${remainColor}">
        <div class="sc-label">${d.remaining >= 0 ? 'Unallocated' : 'Overspent'}</div>
        <div class="sc-val">${fmtD(Math.abs(d.remaining))}</div>
        <div class="sc-target">${fmtP(Math.abs(d.remainPct))} of take-home</div>
        <span class="sc-badge ${d.remaining >= 0 ? 'badge-good' : 'badge-over'}">${d.remaining >= 0 ? 'Available' : 'Over!'}</span>
      </div>
    `;

    // Bar chart
    if (barChart) barChart.destroy();
    barChart = new Chart($('barChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: ['Needs', 'Wants', 'Savings'],
        datasets: [
          {
            label: 'Actual',
            data: [d.needsPct, d.wantsPct, d.savingsPct].map(v => parseFloat(v.toFixed(1))),
            backgroundColor: ['rgba(11,125,103,0.85)', 'rgba(224,123,57,0.85)', 'rgba(107,140,186,0.85)'],
            borderRadius: 5,
          },
          {
            label: 'Target',
            data: [50, 30, 20],
            backgroundColor: ['rgba(11,125,103,0.2)', 'rgba(224,123,57,0.2)', 'rgba(107,140,186,0.2)'],
            borderColor:     ['#0B7D67', '#e07b39', '#6b8cba'],
            borderWidth: 2,
            borderRadius: 5,
          }
        ]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { position: 'top', labels: { boxWidth: 12, font: { size: 11 } } } },
        scales: {
          y: { max: 80, ticks: { callback: v => v + '%' } }
        }
      }
    });

    // Donut chart — all categories with a value
    const donutLabels = [], donutData = [], donutColors = [];
    const needsColors   = ['#0B7D67','#13956e','#1aad80','#22c490','#2ad8a0','#3ae6b0','#4ef0c0','#65f5cc'];
    const wantsColors   = ['#e07b39','#e88c4d','#ef9d62','#f5ae77','#f8be8e','#facca4','#fcd9bb','#fde5cd'];
    const savingsColors = ['#6b8cba','#7a9dc7','#8aaed3','#9abde0','#abc9ea','#bdd4f0','#cedef5','#deeaf9'];

    d.needsItems.forEach((item, i)   => { if (item.amount > 0) { donutLabels.push(item.label); donutData.push(item.amount); donutColors.push(needsColors[i % needsColors.length]); } });
    d.wantsItems.forEach((item, i)   => { if (item.amount > 0) { donutLabels.push(item.label); donutData.push(item.amount); donutColors.push(wantsColors[i % wantsColors.length]); } });
    d.savingsItems.forEach((item, i) => { if (item.amount > 0) { donutLabels.push(item.label); donutData.push(item.amount); donutColors.push(savingsColors[i % savingsColors.length]); } });

    if (donutChart) donutChart.destroy();
    donutChart = new Chart($('donutChart').getContext('2d'), {
      type: 'doughnut',
      data: { labels: donutLabels, datasets: [{ data: donutData, backgroundColor: donutColors, borderWidth: 1, borderColor: '#fff' }] },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: { callbacks: { label: ctx => ` ${ctx.label}: ${fmtD(ctx.parsed)} (${fmtP(ctx.parsed / d.net * 100)})` } }
        }
      }
    });

    // Breakdown table
    const makeRows = (items, bucket, colorClass, fillClass) => {
      const total = items.reduce((s, i) => s + i.amount, 0);
      const rows = items.filter(i => i.amount > 0).map(item => {
        const pct = d.net > 0 ? item.amount / d.net * 100 : 0;
        const barW = Math.min(100, pct * 2);
        return `<tr>
          <td>${bucket}</td>
          <td>${item.label}</td>
          <td>${fmtD(item.amount)}</td>
          <td>${fmtP(pct)}</td>
          <td class="bar-cell"><div class="mini-bar"><div class="mini-fill ${fillClass}" style="width:${barW}%"></div></div></td>
        </tr>`;
      }).join('');
      const totalPct = d.net > 0 ? total / d.net * 100 : 0;
      const sectionRow = `<tr class="section-row">
        <td>${bucket} Total</td><td></td>
        <td>${fmtD(total)}</td>
        <td>${fmtP(totalPct)}</td>
        <td></td>
      </tr>`;
      return rows + sectionRow;
    };

    const totalPct = d.net > 0 ? d.totalSpent / d.net * 100 : 0;
    $('breakdownBody').innerHTML =
      makeRows(d.needsItems, 'Needs', '#0B7D67', 'fill-needs') +
      makeRows(d.wantsItems, 'Wants', '#e07b39', 'fill-wants') +
      makeRows(d.savingsItems, 'Savings', '#6b8cba', 'fill-savings') +
      `<tr class="total-row">
        <td>Total Allocated</td><td></td>
        <td>${fmtD(d.totalSpent)}</td>
        <td>${fmtP(totalPct)}</td>
        <td></td>
      </tr>`;

    // Frameworks comparison
    const frameworks = [
      { name: '50/30/20',  needs: 50, wants: 30, savings: 20, best: 'Middle-income earners, good starting point' },
      { name: '70/20/10',  needs: 70, wants: 20, savings: 10, best: 'Lower-income or high cost-of-living areas' },
      { name: '80/20',     needs: 80, wants:  0, savings: 20, best: 'Simplicity — just protect the 20% savings first' },
      { name: '60/20/20',  needs: 60, wants: 20, savings: 20, best: 'Those paying off debt aggressively' },
      { name: '30/30/30/10',needs:30, wants: 30, savings: 30, best: 'High earners targeting early retirement (10% giving)' },
    ];

    $('frameworkBody').innerHTML = frameworks.map(fw => {
      const nDiff = (d.needsPct   - fw.needs).toFixed(1);
      const wDiff = (d.wantsPct   - fw.wants).toFixed(1);
      const sDiff = (d.savingsPct - fw.savings).toFixed(1);
      const diffStr = (v) => v == 0 ? '—' : (v > 0 ? `+${v}%` : `${v}%`);
      const diffStyle = (v) => parseFloat(v) > 5 ? 'color:#c0392b' : parseFloat(v) < -5 ? 'color:#6b8cba' : 'color:#0B7D67';
      return `<tr>
        <td style="text-align:left;padding:9px 14px;font-weight:700;border-bottom:1px solid #eee">${fw.name}</td>
        <td style="padding:9px 14px;text-align:right;border-bottom:1px solid #eee">
          ${fw.needs}% <span style="font-size:0.75rem;${diffStyle(nDiff)}">(${diffStr(nDiff)})</span>
        </td>
        <td style="padding:9px 14px;text-align:right;border-bottom:1px solid #eee">
          ${fw.wants > 0 ? fw.wants + '%' : '—'} <span style="font-size:0.75rem;${diffStyle(wDiff)}">(${diffStr(wDiff)})</span>
        </td>
        <td style="padding:9px 14px;text-align:right;border-bottom:1px solid #eee">
          ${fw.savings}% <span style="font-size:0.75rem;${diffStyle(sDiff)}">(${diffStr(sDiff)})</span>
        </td>
        <td style="text-align:left;padding:9px 14px;font-size:0.78rem;color:#888;border-bottom:1px solid #eee">${fw.best}</td>
      </tr>`;
    }).join('');

    $('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  updateIncomeSummary();
</script>
</body>
</html>
